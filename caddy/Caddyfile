# WakeDock Dynamic Caddyfile
# This file will be dynamically updated by WakeDock
# Static configuration for WakeDock itself

{
    admin localhost:2019
    auto_https on
    
    # Global options
    servers {
        protocol {
            experimental_http3
        }
    }
}

# WakeDock Dashboard
admin. { $DOMAIN:localhost } {
    reverse_proxy dashboard:3000 {
        header_up Host { upstream_hostport }
        header_up X-Real-IP { remote_host }
        header_up X-Forwarded-For { remote_host }
        header_up X-Forwarded-Proto { scheme }
    }
    
    # SSL for dashboard
    tls {
        on_demand
    }
    
    # Logging
    log {
        output file /var/log/caddy/dashboard.log {
            roll_size 10mb
            roll_keep 3
        }
    }
}

# WakeDock API
api. { $DOMAIN:localhost } {
    reverse_proxy wakedock:8000 {
        header_up Host { upstream_hostport }
        header_up X-Real-IP { remote_host }
        header_up X-Forwarded-For { remote_host }
        header_up X-Forwarded-Proto { scheme }
    }
    
    # SSL for API
    tls {
        on_demand
    }
    
    # Logging
    log {
        output file /var/log/caddy/api.log {
            roll_size 10mb
            roll_keep 3
        }
    }
}

# Default landing page
{ $DOMAIN:localhost } {
    respond "WakeDock is running! üê≥\n\nDashboard: https://admin.{$DOMAIN}\nAPI: https://api.{$DOMAIN}\n\nManaged services will appear at their configured domains." 200
    header Content-Type "text/plain"
}

# Catch-all for managed services (will be dynamically updated)
*. { $DOMAIN:localhost } {
    respond "Service not found or not running. Check WakeDock dashboard for available services." 404
    header Content-Type "text/plain"
}

# Dynamic service configurations will be appended below this line
# --- WAKEDOCK MANAGED SERVICES ---
